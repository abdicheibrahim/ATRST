@using ProjetAtrst.ViewModels.ProjectRequests
@model ProjectRequestsIndexViewModel
@{
    Layout = "_LayoutResearcher";
}
@{
    ViewData["Title"] = "إدارة الطلبات والدعوات";
}

<h2 class="mb-4">إدارة الطلبات والدعوات</h2>

<div class="accordion" id="requestsAccordion">

    <!-- 1. طلبات الانضمام إلى مشاريعي -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingJoinRequestsToMyProjects">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseJoinRequestsToMyProjects">
                طلبات الانضمام إلى مشاريعي
            </button>
        </h2>
        <div id="collapseJoinRequestsToMyProjects" class="accordion-collapse collapse show" data-bs-parent="#requestsAccordion">
            <div class="accordion-body">

                @if (!Model.JoinRequestsToMyProject.Any())
                {
                    <p class="text-muted">لا توجد طلبات حاليًا.</p>
                }
                else
                {
                    @foreach (var group in Model.JoinRequestsToMyProject)
                    {
                        <div class="card mb-3">
                            <div class="card-header bg-light fw-bold">
                                @group.ProjectTitle
                            </div>
                            <ul class="list-group list-group-flush">
                                @foreach (var req in group.JoinRequests)
                                {
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>@req.RequesterFullName</strong>
                                            <span class="text-muted">(@req.RequestedAt.ToShortDateString())</span>
                                        </div>
                                        <span class="badge bg-secondary">@req.Status</span>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                }

            </div>
        </div>
    </div>

    <!-- 2. دعوات أرسلتها -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingInvitationsISent">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInvitationsISent">
                الدعوات التي أرسلتها
            </button>
        </h2>
        <div id="collapseInvitationsISent" class="accordion-collapse collapse" data-bs-parent="#requestsAccordion">
            <div class="accordion-body">
                @if (!Model.InvitationsISent.Any())
                {
                    <p class="text-muted">لا توجد دعوات مرسلة.</p>
                }
                else
                {
                    <ul class="list-group">
                        @foreach (var inv in Model.InvitationsISent)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@inv.ReceiverFullName</strong> &ndash;
                                    <span class="text-muted">(@inv.ProjectTitle)</span>
                                </div>
                                <span class="badge bg-secondary">@inv.Status</span>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>

    <!-- 3. طلبات أرسلتها -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingJoinRequestsISent">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseJoinRequestsISent">
                الطلبات التي أرسلتها
            </button>
        </h2>
        <div id="collapseJoinRequestsISent" class="accordion-collapse collapse" data-bs-parent="#requestsAccordion">
            <div class="accordion-body">
                @if (!Model.JoinRequestsISent.Any())
                {
                    <p class="text-muted">لا توجد طلبات مرسلة.</p>
                }
                else
                {
                    <ul class="list-group">
                        @foreach (var req in Model.JoinRequestsISent)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@req.ProjectTitle</strong>
                                    <span class="text-muted">(@req.RequestedAt.ToShortDateString())</span>
                                </div>
                                <span class="badge bg-secondary">@req.Status</span>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>

    <!-- 4. دعوات استقبلتها -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingInvitationsIReceived">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInvitationsIReceived">
                الدعوات التي استقبلتها
            </button>
        </h2>
        <div id="collapseInvitationsIReceived" class="accordion-collapse collapse" data-bs-parent="#requestsAccordion">
            <div class="accordion-body">
                @if (!Model.InvitationsIReceived.Any())
                {
                    <p class="text-muted">لا توجد دعوات واردة.</p>
                }
                else
                {
                    <ul class="list-group">
                        @foreach (var inv in Model.InvitationsIReceived)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@inv.ProjectTitle</strong> من <strong>@inv.SenderLeaderFullName</strong>
                                    <span class="text-muted">(@inv.SentAt.ToShortDateString())</span>
                                </div>
                                <span class="badge bg-secondary">@inv.Status</span>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>

</div>
