@using ProjetAtrst.ViewModels.Researcher
@model EditResearcherProfileViewModel

@{
    Layout = "_LayoutResearcher";
}

@{
    ViewData["Title"] = "Profile";
}

<div class="alert alert-success text-center alert-dismissible fade show" role="alert">
    Votre profil est<strong> complet.</strong> Vous pouvez le modifier ici.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<form asp-action="EditProfile" method="post">
   
    <div class=" row shadow-sm g-3 needs-validation  p-3 mb-5 mt-3 bg-white border rounded">
        <h5>Employments Details</h5>
        <div class="col-md-6">
            <label asp-for="Establishment" class="form-label">Establishment</label>
            <select asp-for="Establishment" asp-items="Model.EstablishmentsList" class="form-select" id="establishmentSelect"></select>
            <span asp-validation-for="Establishment" class="text-danger"></span>

            <input type="text" id="customEstablishment" name="Establishment" class="form-control mt-2 d-none" placeholder="أدخل اسم المؤسسة يدوياً" />
        </div>

        <div class="col-md-6">
            <label asp-for="Grade" class="form-label"></label>
            <input type="text" class="form-control input" asp-for="Grade">
            <span asp-validation-for="Grade"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Speciality" class="form-label"></label>
            <input type="text" class="form-control input" asp-for="Speciality">
            <span asp-validation-for="Speciality"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Mobile" class="form-label"></label>
            <input type="text" class="form-control input" asp-for="Mobile">
            <span asp-validation-for="Mobile"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="Diploma" class="form-label"></label>
            <input type="text" class="form-control input" asp-for="Diploma">
            <span asp-validation-for="Diploma"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="DipInstitution" class="form-label"></label>
            <input type="text" class="form-control input" asp-for="DipInstitution">
            <span asp-validation-for="DipInstitution"></span>
        </div>
        <div class="col-md-6">
            <label asp-for="DipDate" class="form-label"></label>
            <input type="date" class="form-control input" asp-for="DipDate">
            <span asp-validation-for="DipDate"></span>
        </div>



    </div>


    <button type="submit" class="btn btn-success w-100"><i class="bi bi-pencil-square me-2"></i>Modifier</button>
</form>


@section Scripts
{
    <partial name="_ValidationScriptsPartial" />

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>


    <script>
        function normalizeString(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        function customMatcher(params, data) {
            if ($.trim(params.term) === '') return data;
            const term = normalizeString(params.term);
            const text = normalizeString(data.text);
            return text.includes(term) ? data : null;
        }

                $(document).ready(function () {
            $('#establishmentSelect').select2({
                theme: 'bootstrap-5',
                width: '100%',
                matcher: customMatcher
            });

            // ✅ عند الفتح، ركّز المؤشر في مربع البحث تلقائيًا
            $('#establishmentSelect').on('select2:open', function () {
                setTimeout(function () {
                    document.querySelector('.select2-container--open .select2-search__field').focus();
                }, 0);
            });
        });

    </script>

}


