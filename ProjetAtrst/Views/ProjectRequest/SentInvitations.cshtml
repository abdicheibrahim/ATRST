@model IEnumerable<ProjectRequest>

@{
    ViewData["Title"] = "Requêtes reçues 📨 ";

}
<div class="mb-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2">
        <h2 class="mb-0">Demandes reçues 📨</h2>
        <div class="d-flex flex-column flex-sm-row gap-2">
            <a class="btn btn-outline-success" asp-controller="Project" asp-action="AvailableProjects">
                <i class="bi bi-person-plus"></i> Rejoindre un projet
            </a>
        </div>
    </div>
</div>
<div class="mb-3">
    <button class="btn btn-outline-secondary status-filter" data-status="all">Tous</button>
    <button class="btn btn-outline-warning status-filter" data-status="pending">Suspendu</button>
    <button class="btn btn-outline-success status-filter" data-status="accepted">Accepté</button>
    <button class="btn btn-outline-danger status-filter" data-status="rejected">Rejeté</button>
</div>

<div class="table-responsive">
    <table id="requestsTable" class="table table-bordered table-striped align-middle shadow-sm">
        <thead class="table-success">
            <tr>
                <th>Expéditeur</th>
                <th>Projet</th>
                <th>Message</th>
                <th>Statut</th>
                <th>Date d'envoi</th>
                <th>Options</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var req in Model)
            {
                <tr>
                    <td>@req.Receiver?.User?.FullName</td>
                    <td>@req.Project?.Title</td>
                    <td>@req.Message</td>
                    <td>
                        @switch (req.Status)
                        {
                            case RequestStatus.Pending:
                                <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>Suspendu</span>
                                break;
                            case RequestStatus.Accepted:
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Accepté</span>
                                break;
                            case RequestStatus.Rejected:
                                <span class="badge bg-danger"><i class="bi bi-x-circle me-1"></i>Rejeté</span>
                                break;
                        }
                    </td>
                    <td>@req.CreatedAt.ToString("yyyy-MM-dd")</td>
                    <td>
                        <div class="d-flex gap-1">
                            <a asp-controller="ProjectRequest" asp-action="Details" asp-route-id="@req.Id" class="btn btn-outline-primary btn-sm" title="Détails">
                                <i class="bi bi-eye"></i>
                            </a>

                            @if (req.Status == RequestStatus.Pending)
                            {
                                <form asp-controller="ProjectRequest" asp-action="Cancel" asp-route-id="@req.Id" method="post" class="d-inline">
                                    <button type="submit" class="btn btn-outline-danger btn-sm" title="إلغاء">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </form>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


@section scripts {

    <!-- إضافة مكتبات DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="~/js/datatablesincsr.js"></script>
}